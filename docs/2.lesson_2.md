# Functions

Learning objectives:

* Understand the anatomy of a function
* Be able to write a function
* Write functions that have predictable outputs
 
Think of functions as verbs. They do something to your data and generates some output. In your R journey, you have been using pre-coded functions. Here, we will write our own functions to perform some task. All functions have the following structure:

```r
do_something <- function(x, y) {
  # ...doing something with x and y...
  # Addition of x and y
  x + y
}
```

In the pseudo-code above, we have a function *named* `do_something` that takes *arguments* `x` and `y` and then a *body* enveloped by `{...}` that has code performing an addition between the arguments.

## Understanding functions by writing one

A cornerstone concept in ecology is species diversity. This pertains to how organisms are distributed across space. Simplified in the form of a question: "How diverse is a sample?" The most direct measure of diversity is richness (often denoted using the letter $q$). This is essentially the number of organisms present in a sample. For any sample (remember, these are columns) in our ASV table, we can obtain richness by counting the number of non-zero elements in the column vector:

!!! r-project ""

    ```r
    # The species richness of sample AS1A1
    sum(asv$AS1A1 > 0)
    ```

    !!! success "Output"

        ```
        [1] 1221
        ```

For a simple measure of richness, you can probably do this manually via copy-paste for multiple sample:

!!! r-project ""

    ```r
    sum(asv$AS1A2 > 0)
    sum(asv$AS1A3 > 0)
    sum(asv$AS1B1 > 0)
    sum(asv$AS1B2 > 0)
    # etc...
    sum(asv$S3C3 > 0)
    ```

    !!! success "Output"

        ```
        [1] 744
        [1] 1149
        [1] 1169
        [1] 1161
        [1] 305
        ```

One drawback with richness is that the measure gives equal weight to abundant and rare organisms. Another measure of sample diversity is the Shannon index (denoted with the Greek uppercase eta $\eta$, $\textrm{H}$ as it was originally conceived as a measure of information **entropy**). This is calculated using the following formula:

$$\textrm{H} = - \sum_{i=1}^{q} {p_i} \log {p_i}$$

where $p_i$ is the proportion of the $i$<sup>th</sup> organism relative to the sample total (also known as the relative frequency of the organism).

$$p_i = \frac{x_i}{\sum_{i=1}^{q} x_i}$$

If you were to calculate the Shannon's index for a sample, if would look like this:

!!! r-project ""

    ```r
    # Calculate the relative frequency of each ASV
    p_AS1A1 <- asv$AS1A1 / sum(asv$AS1A1)
    # Calculate the multiplication between relative frequencies and its log
    pp_AS1A1 <- p_AS1A1 * log(p_AS1A1)
    # Calculate the Shannon's index
    - sum(pp_AS1A1, na.rm = TRUE)
    # Note that you will need na.rm = TRUE as there are zeroes in the vector and the logarithm of zero is NaN (it is not mathematically defined)
    ```

    !!! success "Output"

        ```
        [1] 6.651707
        ```

Now modify the vectors 22 times! How cumbersome! However, we know we can turn the calculations into a function, like so:

!!! r-project ""

    ```r
    shannon_index <- function(abundance) {
      # Calculate relative frequency
      p_i <- abundance / sum(abundance)
      # Calculate multiplication between relative frequencies and its log
      pp_i <- p_i * log(p_i)
      # Calculate Shannon's index
      - sum(pp_i, na.rm = TRUE) 
    }
    ```

Here, we have written a function that calculates the index and provided it with an informative name. Lets try it out and see if we get the same output:

!!! r-project ""

    ```r
    shannon_index(abundance = asv$AS1A1)
    ```

    !!! success "Output"

        ```
        [1] 6.651707
        ```





# Iteration using loops

Learning objectives:

* Understand the `for` construct
* Understand the difference between iterating vectors directly or their indices
* Be able to assign results of an iteration to object






# 